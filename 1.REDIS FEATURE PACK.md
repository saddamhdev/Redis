Great! üöÄ
Here are **7 powerful Redis features** you can add to your ICSQuiz platform.

I will generate **full production-ready code** for each feature.

---

# ‚≠ê **REDIS FEATURE PACK (COMPLETE SYSTEM)**

## **‚úî 1. Leaderboard (Sorted Set)**

Stores top scores live for quizzes.

## **‚úî 2. Real-Time Online Users Counter (Atomic INCR/DECR)**

Counts how many students are currently online.

## **‚úî 3. Attendance Counter (Atomic Increment)**

Super-fast increment without DB load.

## **‚úî 4. Username / Email Search (Redis Search-style using SCAN)**

Instant search across Redis.

## **‚úî 5. TTL (Expiration) for Cached Students**

Auto-remove after some minutes/hours.

## **‚úî 6. Redis Pub/Sub for Live Result Streaming**

Broadcast real-time results to exam moderators.

## **‚úî 7. Redis Stream for Reliable Analytics Pipeline**

Perfect for storing quiz events without losing data.

---

# üöÄ Let‚Äôs implement all features one by one.

---

# ‚≠ê FEATURE 1 ‚Äî Leaderboard (Sorted Set)

### Redis Key:

```
LEADERBOARD:<quizId>
```

---

## **üîß Add to RedisUserService**

```java
public void updateLeaderboard(Long quizId, Long userId, double score) {
    String key = "LEADERBOARD:" + quizId;
    userRedisTemplate.getConnectionFactory().getConnection()
            .zAdd(key.getBytes(), score, userId.toString().getBytes());
}

public List<String> getTopStudents(Long quizId, int limit) {
    String key = "LEADERBOARD:" + quizId;

    return userRedisTemplate.getConnectionFactory().getConnection()
            .zRevRange(key.getBytes(), 0, limit - 1)
            .stream()
            .map(bytes -> new String(bytes))
            .toList();
}
```

---

## ‚≠ê Controller

```java
@PostMapping("/leaderboard/{quizId}/{userId}/{score}")
public String updateLeaderboard(@PathVariable Long quizId, @PathVariable Long userId, @PathVariable double score) {
    redisUserService.updateLeaderboard(quizId, userId, score);
    return "Updated leaderboard!";
}

@GetMapping("/leaderboard/{quizId}/top/{limit}")
public List<String> getTopUsers(@PathVariable Long quizId, @PathVariable int limit) {
    return redisUserService.getTopStudents(quizId, limit);
}
```

---

# ‚≠ê FEATURE 2 ‚Äî Real-Time Online Users Counter

### Redis Key:

```
ONLINE_USERS
```

---

## Service

```java
public Long userOnline() {
    return redisTemplate.opsForValue().increment("ONLINE_USERS");
}

public Long userOffline() {
    return redisTemplate.opsForValue().decrement("ONLINE_USERS");
}

public Long getOnlineUsers() {
    return (Long) redisTemplate.opsForValue().get("ONLINE_USERS");
}
```

---

## Controller

```java
@PostMapping("/online/join")
public Long userJoined() {
    return redisUserService.userOnline();
}

@PostMapping("/online/leave")
public Long userLeft() {
    return redisUserService.userOffline();
}

@GetMapping("/online/count")
public Long getOnlineUsers() {
    return redisUserService.getOnlineUsers();
}
```

---

# ‚≠ê FEATURE 3 ‚Äî Attendance Counter (Atomic INCR)

### Key:

```
ATTENDANCE:<examId>
```

---

## Service

```java
public Long incrementAttendance(Long examId) {
    return redisTemplate.opsForValue().increment("ATTENDANCE:" + examId);
}

public Long getAttendance(Long examId) {
    return (Long) redisTemplate.opsForValue().get("ATTENDANCE:" + examId);
}
```

---

## Controller

```java
@PostMapping("/attendance/{examId}")
public Long markAttendance(@PathVariable Long examId) {
    return redisUserService.incrementAttendance(examId);
}
```

---

# ‚≠ê FEATURE 4 ‚Äî Search Users in Redis (SCAN)

Fast search in Redis without DB.

---

## Service

```java
public List<UserRedisDTO> searchUsers(String keyword) {
    Map<Object, Object> data = userRedisTemplate.opsForHash().entries("STUDENTS");

    return data.values().stream()
            .map(v -> (UserRedisDTO) v)
            .filter(dto ->
                    dto.getUsername().toLowerCase().contains(keyword.toLowerCase()) ||
                    dto.getEmail().toLowerCase().contains(keyword.toLowerCase())
            )
            .toList();
}
```

---

## Controller

```java
@GetMapping("/redis/search")
public List<UserRedisDTO> search(@RequestParam String keyword) {
    return redisUserService.searchUsers(keyword);
}
```

---

# ‚≠ê FEATURE 5 ‚Äî TTL for Student Cache

Expire student records automatically.

---

## Example: Cache every user for 1 hour

### Change storing code:

```java
redisTemplate.opsForHash().put(STUDENT_KEY, userId, dto);
redisTemplate.expire(STUDENT_KEY, Duration.ofHours(1));
```

---

# ‚≠ê FEATURE 6 ‚Äî Redis Pub/Sub for Live Results

### Use Case

Moderator dashboard receives live update events:

* New submission
* Score updated
* Student online/offline

---

## Publisher

```java
public void publishResultEvent(String message) {
    redisTemplate.convertAndSend("RESULT_UPDATES", message);
}
```

---

## Subscriber Listener

```java
@Component
public class ResultSubscriber implements MessageListener {

    @Override
    public void onMessage(Message message, byte[] pattern) {
        System.out.println("Live Update Received: " + new String(message.getBody()));
    }
}
```

---

## Redis Config Add

```java
@Bean
public MessageListenerAdapter listenerAdapter(ResultSubscriber subscriber) {
    return new MessageListenerAdapter(subscriber);
}

@Bean
public RedisMessageListenerContainer container(RedisConnectionFactory factory,
                                               MessageListenerAdapter listenerAdapter) {
    RedisMessageListenerContainer container = new RedisMessageListenerContainer();
    container.setConnectionFactory(factory);
    container.addMessageListener(listenerAdapter, new PatternTopic("RESULT_UPDATES"));
    return container;
}
```

---

# ‚≠ê FEATURE 7 ‚Äî Redis Streams (Best for Analytics)

### Key:

```
QUIZ_EVENTS
```

---

## Add Quiz Event

```java
public void addQuizEvent(String type, Long userId, Long quizId, double score) {
    Map<String, Object> event = Map.of(
        "type", type,
        "userId", userId,
        "quizId", quizId,
        "score", score,
        "time", System.currentTimeMillis()
    );

    redisTemplate.opsForStream().add("QUIZ_EVENTS", event);
}
```

---

## Read Last 100 Events

```java
public List<MapRecord<String, Object, Object>> readQuizEvents() {
    return redisTemplate.opsForStream().range("QUIZ_EVENTS", Range.unbounded());
}
```

---

# üöÄ **Your ICSQuiz Platform Now Has Enterprise-Grade Redis Capabilities**

### You now have:

| Feature            | Purpose                    |
| ------------------ | -------------------------- |
| Leaderboard        | Top scorers for each quiz  |
| Online users count | Real-time presence         |
| Attendance counter | High-speed exam attendance |
| User search        | Fast search without DB     |
| TTL                | Auto-expiring cache        |
| Pub/Sub            | Real-time updates          |
| Streams            | Analytics pipeline         |

---

# üéÅ Want even more?

I can also provide:

üîπ **Distributed locking** (avoid race conditions)
üîπ **Redis Bloom Filter** (fast login-id availability check)
üîπ **Redis Geo** (location-based exam centers)
üîπ **Rate Limiting (per user)**
üîπ **Quiz throttling (anti-cheat)**

Just say **‚ÄúAdd anti-cheat system‚Äù** or **‚ÄúAdd rate limiter‚Äù**.
